<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Upload ·∫¢nh & L·∫•y Link</title>
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --panel: #111827; /* gray-900 */
        --muted: #94a3b8; /* slate-400 */
        --text: #e5e7eb; /* gray-200 */
        --primary: #22d3ee; /* cyan-400 */
        --accent: #a78bfa; /* violet-400 */
        --danger: #fb7185; /* rose-400 */
        --ok: #34d399; /* emerald-400 */
        --warn: #fbbf24; /* amber-400 */
        --radius: 18px;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: radial-gradient(
            1200px 500px at 80% -10%,
            #1f2937,
            transparent
          ),
          radial-gradient(1000px 600px at -10% 10%, #1f2937, transparent),
          var(--bg);
        color: var(--text);
        font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, "Helvetica Neue", Arial;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px;
      }
      .app {
        width: clamp(320px, 92vw, 960px);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      header {
        padding: 20px 22px;
        display: flex;
        align-items: center;
        gap: 14px;
        background: rgba(0, 0, 0, 0.25);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      header .logo {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.3);
      }
      header h1 {
        font-size: 20px;
        margin: 0;
      }
      header p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .content {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 20px;
        padding: 20px;
      }
      @media (max-width: 900px) {
        .content {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background: rgba(17, 24, 39, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 16px;
      }
      .panel h2 {
        margin: 0 0 10px;
        font-size: 16px;
      }
      .muted {
        color: var(--muted);
      }

      .dropzone {
        border: 2px dashed rgba(255, 255, 255, 0.18);
        border-radius: 14px;
        padding: 20px;
        text-align: center;
        transition: 0.2s ease;
        display: grid;
        gap: 10px;
        place-items: center;
        min-height: 180px;
        cursor: pointer;
        background: rgba(2, 6, 23, 0.4);
      }
      .dropzone.hover {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(34, 211, 238, 0.2) inset;
      }
      .dropzone input {
        display: none;
      }

      .preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        margin-top: 12px;
      }
      .card {
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 14px;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.25);
      }
      .card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
        display: block;
      }
      .card .meta {
        padding: 8px 10px;
        font-size: 12px;
        color: var(--muted);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }
      button,
      .btn {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text);
        background: rgba(255, 255, 255, 0.06);
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        letter-spacing: 0.2px;
        transition: 0.15s ease;
      }
      button:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.12);
      }
      .btn-primary {
        background: linear-gradient(135deg, var(--primary), #0891b2);
        border: none;
      }
      .btn-accent {
        background: linear-gradient(135deg, var(--accent), #7c3aed);
        border: none;
      }
      .btn-ok {
        background: linear-gradient(135deg, var(--ok), #059669);
        border: none;
      }
      .btn-danger {
        background: linear-gradient(135deg, var(--danger), #e11d48);
        border: none;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .field {
        display: grid;
        gap: 6px;
      }
      .field label {
        font-size: 12px;
        color: var(--muted);
      }
      .field input {
        width: 100%;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        color: var(--text);
      }

      .output {
        display: grid;
        gap: 10px;
      }
      .output textarea {
        width: 100%;
        min-height: 90px;
        resize: vertical;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        color: var(--text);
        padding: 10px;
      }

      .status {
        font-size: 13px;
        color: var(--muted);
      }
      .badge {
        display: inline-grid;
        place-items: center;
        padding: 6px 10px;
        font-size: 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(255, 255, 255, 0.06);
      }
      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        background: #0b1220;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0.2rem 0.4rem;
        border-radius: 6px;
      }
      .small {
        font-size: 12px;
        color: var(--muted);
      }
      .hint {
        margin-top: 6px;
        color: var(--muted);
        font-size: 12px;
      }
      .list {
        margin: 6px 0 0 14px;
        color: var(--muted);
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="app" id="app">
      <header>
        <div class="logo">üì§</div>
        <div>
          <h1>Upload ·∫¢nh & L·∫•y Link</h1>
          <p>
            H·ªó tr·ª£: k√©o th·∫£, ch·ªçn file, d√°n t·ª´ clipboard, link t·∫°m (blob:),
            Imgur, Cloudinary.
          </p>
        </div>
      </header>

      <div class="content">
        <!-- LEFT: UPLOAD & PREVIEW -->
        <section class="panel">
          <h2>1) Ch·ªçn ·∫£nh</h2>
          <div class="dropzone" id="dropzone">
            <input type="file" id="fileInput" accept="image/*" multiple />
            <div>
              <div style="font-size: 18px; font-weight: 700">
                K√©o & th·∫£ ·∫£nh v√†o ƒë√¢y
              </div>
              <div class="muted">
                ho·∫∑c b·∫•m ƒë·ªÉ ch·ªçn ‚Ä¢ c≈©ng h·ªó tr·ª£
                <span class="kbd">Ctrl/‚åò+V</span> ƒë·ªÉ d√°n ·∫£nh
              </div>
            </div>
          </div>
          <div class="preview" id="preview"></div>

          <div class="actions">
            <button class="btn-primary" id="btnTemp">
              T·∫°o link t·∫°m (blob:)
            </button>
            <button class="btn-accent" id="btnImgur">Upload l√™n Imgur</button>
            <button class="btn-ok" id="btnCloudinary">
              Upload l√™n Cloudinary
            </button>
            <button id="btnClear" class="btn">Xo√° danh s√°ch</button>
          </div>
          <div class="hint">
            L∆∞u √Ω: Link <b>blob:</b> ch·ªâ d√πng t·∫°m trong tr√¨nh duy·ªát hi·ªán t·∫°i v√†
            kh√¥ng chia s·∫ª ƒë∆∞·ª£c cho ng∆∞·ªùi kh√°c. ƒê·ªÉ c√≥ link c√¥ng khai, d√πng Imgur
            ho·∫∑c Cloudinary b√™n ph·∫£i.
          </div>
        </section>

        <!-- RIGHT: CONFIG & OUTPUT -->
        <section class="panel">
          <h2>2) C·∫•u h√¨nh d·ªãch v·ª• & K·∫øt qu·∫£</h2>
          <div class="row">
            <div class="field">
              <label>Imgur Client-ID (t√πy ch·ªçn)</label>
              <input
                id="imgurClientId"
                placeholder="V√≠ d·ª•: 123abc456def‚Ä¶ (y√™u c·∫ßu t·∫°o app Imgur)"
              />
            </div>
            <div class="field">
              <label>Cloudinary Cloud Name</label>
              <input id="cldName" placeholder="v√≠ d·ª•: your_cloud_name" />
            </div>
          </div>
          <div class="row" style="margin-top: 10px">
            <div class="field">
              <label>Cloudinary Unsigned Upload Preset</label>
              <input id="cldPreset" placeholder="v√≠ d·ª•: unsigned_preset" />
            </div>
            <div class="field">
              <label>Th∆∞ m·ª•c (Cloudinary, tu·ª≥ ch·ªçn)</label>
              <input id="cldFolder" placeholder="v√≠ d·ª•: uploads/web" />
            </div>
          </div>

          <div class="output" style="margin-top: 14px">
            <label>Link t·∫°o ra (m·ªói d√≤ng l√† 1 ·∫£nh):</label>
            <textarea id="output" readonly></textarea>
            <div class="actions">
              <button id="btnCopy" class="btn">Sao ch√©p</button>
              <span class="badge" id="copyStatus" style="display: none"
                >ƒê√£ sao ch√©p ‚úì</span
              >
            </div>
            <div class="status" id="status">Ch∆∞a c√≥ t√°c v·ª•.</div>
          </div>

          <details style="margin-top: 12px">
            <summary>H∆∞·ªõng d·∫´n nhanh</summary>
            <ul class="list">
              <li>
                D√πng <b>link t·∫°m (blob:)</b> ƒë·ªÉ xem nhanh tr∆∞·ªõc khi upload th·∫≠t.
              </li>
              <li>
                ƒê·ªÉ c√≥ link c√¥ng khai b·ªÅn v·ªØng, nh·∫≠p <b>Imgur Client-ID</b> v√†
                b·∫•m ‚ÄúUpload l√™n Imgur‚Äù, ho·∫∑c nh·∫≠p <b>Cloud Name</b> +
                <b>Unsigned Preset</b> v√† b·∫•m ‚ÄúUpload l√™n Cloudinary‚Äù.
              </li>
              <li>
                B·∫≠t ‚ÄúUnsigned Upload‚Äù trong Cloudinary Console ƒë·ªÉ d√πng kh√¥ng c·∫ßn
                secret.
              </li>
            </ul>
          </details>
        </section>
      </div>
    </div>

    <script>
      const dropzone = document.getElementById("dropzone");
      const fileInput = document.getElementById("fileInput");
      const preview = document.getElementById("preview");
      const btnTemp = document.getElementById("btnTemp");
      const btnImgur = document.getElementById("btnImgur");
      const btnCloud = document.getElementById("btnCloudinary");
      const btnClear = document.getElementById("btnClear");
      const output = document.getElementById("output");
      const statusEl = document.getElementById("status");
      const btnCopy = document.getElementById("btnCopy");
      const copyStatus = document.getElementById("copyStatus");

      const imgurClientIdEl = document.getElementById("imgurClientId");
      const cldNameEl = document.getElementById("cldName");
      const cldPresetEl = document.getElementById("cldPreset");
      const cldFolderEl = document.getElementById("cldFolder");

      let files = [];

      function humanSize(bytes) {
        const units = ["B", "KB", "MB", "GB"];
        let i = 0,
          n = bytes;
        while (n >= 1024 && i < units.length - 1) {
          n /= 1024;
          i++;
        }
        return `${n.toFixed(n >= 10 || i === 0 ? 0 : 1)} ${units[i]}`;
      }

      function renderPreview() {
        preview.innerHTML = "";
        files.forEach((f, idx) => {
          const url = URL.createObjectURL(f);
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
          <img src="${url}" alt="preview-${idx}" onload="URL.revokeObjectURL('${url}')"/>
          <div class="meta">
            <span title="${f.name}">${
            f.name.length > 18
              ? f.name.slice(0, 8) + "‚Ä¶" + f.name.slice(-8)
              : f.name
          }</span>
            <span>${humanSize(f.size)}</span>
          </div>`;
          preview.appendChild(card);
        });
      }

      function setStatus(msg) {
        statusEl.textContent = msg;
      }

      function pushOutput(lines) {
        const existing = output.value.trim();
        const toAdd = Array.isArray(lines)
          ? lines.join("\n")
          : String(lines || "");
        output.value = existing ? existing + "\n" + toAdd : toAdd;
        output.scrollTop = output.scrollHeight;
      }

      // File selection handlers
      dropzone.addEventListener("click", () => fileInput.click());
      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropzone.classList.add("hover");
      });
      dropzone.addEventListener("dragleave", () =>
        dropzone.classList.remove("hover")
      );
      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropzone.classList.remove("hover");
        const dropped = [...(e.dataTransfer?.files || [])].filter((f) =>
          f.type.startsWith("image/")
        );
        if (dropped.length) {
          files.push(...dropped);
          renderPreview();
          setStatus(`ƒê√£ th√™m ${dropped.length} ·∫£nh.`);
        }
      });

      fileInput.addEventListener("change", (e) => {
        const selected = [...(e.target.files || [])].filter((f) =>
          f.type.startsWith("image/")
        );
        if (selected.length) {
          files.push(...selected);
          renderPreview();
          setStatus(`ƒê√£ ch·ªçn ${selected.length} ·∫£nh.`);
        }
        fileInput.value = "";
      });

      // Paste support
      window.addEventListener("paste", (e) => {
        const items = [...(e.clipboardData?.items || [])];
        const imgs = items
          .map((it) => (it.kind === "file" ? it.getAsFile() : null))
          .filter(Boolean)
          .filter((f) => f.type.startsWith("image/"));
        if (imgs.length) {
          files.push(...imgs);
          renderPreview();
          setStatus(`D√°n ${imgs.length} ·∫£nh t·ª´ clipboard.`);
        }
      });

      // Temp blob links
      btnTemp.addEventListener("click", () => {
        if (!files.length)
          return setStatus("Ch∆∞a c√≥ ·∫£nh. H√£y ch·ªçn/k√©o-th·∫£/d√°n ·∫£nh tr∆∞·ªõc.");
        const links = files.map((f) => URL.createObjectURL(f));
        pushOutput(links);
        setStatus(
          `ƒê√£ t·∫°o ${links.length} link t·∫°m (blob:). L∆∞u √Ω: ch·ªâ ho·∫°t ƒë·ªông trong tr√¨nh duy·ªát hi·ªán t·∫°i.`
        );
      });

      // Imgur upload
      async function uploadImgur(file, clientId) {
        const fd = new FormData();
        fd.append("image", file);
        const res = await fetch("https://api.imgur.com/3/image", {
          method: "POST",
          headers: { Authorization: `Client-ID ${clientId}` },
          body: fd,
        });
        if (!res.ok) {
          throw new Error(`Imgur l·ªói ${res.status}`);
        }
        const json = await res.json();
        if (!json?.data?.link) throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c link t·ª´ Imgur");
        return json.data.link;
      }

      btnImgur.addEventListener("click", async () => {
        if (!files.length) return setStatus("Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ upload.");
        const clientId = imgurClientIdEl.value.trim();
        if (!clientId) return setStatus("H√£y nh·∫≠p Imgur Client-ID ƒë·ªÉ upload.");
        setStatus("ƒêang upload l√™n Imgur‚Ä¶");
        try {
          const results = [];
          for (const f of files) {
            const link = await uploadImgur(f, clientId);
            results.push(link);
            pushOutput(link);
          }
          setStatus(`T·∫£i l√™n Imgur th√†nh c√¥ng ${results.length} ·∫£nh.`);
        } catch (err) {
          console.error(err);
          setStatus("Upload Imgur th·∫•t b·∫°i: " + err.message);
        }
      });

      // Cloudinary upload (unsigned)
      async function uploadCloudinary(file, cloudName, preset, folder) {
        const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
        const fd = new FormData();
        fd.append("upload_preset", preset);
        fd.append("file", file);
        if (folder) fd.append("folder", folder);
        const res = await fetch(url, { method: "POST", body: fd });
        if (!res.ok) {
          throw new Error(`Cloudinary l·ªói ${res.status}`);
        }
        const json = await res.json();
        if (!json?.secure_url)
          throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c secure_url t·ª´ Cloudinary");
        return json.secure_url;
      }

      btnCloud.addEventListener("click", async () => {
        if (!files.length) return setStatus("Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ upload.");
        const cloud = cldNameEl.value.trim();
        const preset = cldPresetEl.value.trim();
        const folder = cldFolderEl.value.trim();
        if (!cloud || !preset)
          return setStatus("Nh·∫≠p Cloud Name v√† Unsigned Upload Preset tr∆∞·ªõc.");
        setStatus("ƒêang upload l√™n Cloudinary‚Ä¶");
        try {
          const results = [];
          for (const f of files) {
            const link = await uploadCloudinary(f, cloud, preset, folder);
            results.push(link);
            pushOutput(link);
          }
          setStatus(`T·∫£i l√™n Cloudinary th√†nh c√¥ng ${results.length} ·∫£nh.`);
        } catch (err) {
          console.error(err);
          setStatus("Upload Cloudinary th·∫•t b·∫°i: " + err.message);
        }
      });

      // Clear
      btnClear.addEventListener("click", () => {
        files = [];
        preview.innerHTML = "";
        output.value = "";
        setStatus("ƒê√£ xo√° danh s√°ch.");
      });

      // Copy
      btnCopy.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(output.value);
          copyStatus.style.display = "inline-grid";
          setTimeout(() => (copyStatus.style.display = "none"), 1200);
        } catch (err) {
          setStatus("Kh√¥ng th·ªÉ sao ch√©p: " + err.message);
        }
      });
    </script>
  </body>
</html>
