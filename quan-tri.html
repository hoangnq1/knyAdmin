<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="vite-icon.svg" type="image/svg+xml" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <title>Dashboard Quản Trị Hệ Thống</title>
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --success: #4cc9f0;
        --danger: #f72585;
        --warning: #f8961e;
        --info: #4895ef;
        --dark: #212529;
        --light: #f8f9fa;
        --sidebar-width: 250px;
        --header-height: 60px;
        --border-radius: 12px;
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(120deg, #f6d365, #fda085);
        color: var(--dark);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        padding: 20px 0;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        transition: var(--transition);
        z-index: 1000;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .sidebar-header h2 {
        color: var(--primary);
        font-size: 1.5rem;
        margin-top: 10px;
      }

      .sidebar-menu {
        list-style: none;
        padding: 10px 0;
      }

      .sidebar-menu li {
        margin-bottom: 5px;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        text-decoration: none;
        color: var(--dark);
        transition: var(--transition);
        border-left: 4px solid transparent;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary);
        border-left-color: var(--primary);
      }

      .sidebar-menu i {
        margin-right: 10px;
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 20px;
        transition: var(--transition);
      }

      .header {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        padding: 15px 20px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .header h1 {
        font-size: 1.8rem;
        color: var(--primary);
      }

      .user-info {
        display: flex;
        align-items: center;
      }

      .user-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
      }

      /* Dashboard Cards */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-title {
        font-size: 1.2rem;
        color: var(--dark);
      }

      .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
      }

      .bg-primary {
        background: var(--primary);
      }
      .bg-success {
        background: var(--success);
      }
      .bg-danger {
        background: var(--danger);
      }
      .bg-warning {
        background: var(--warning);
      }

      .card-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 10px 0;
        color: var(--dark);
      }

      .card-desc {
        color: #6c757d;
        font-size: 0.9rem;
      }

      /* Action Buttons */
      .action-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px 15px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        text-align: center;
      }

      .btn i {
        margin-right: 8px;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }
      .btn-primary:hover {
        background: var(--secondary);
      }

      .btn-success {
        background: var(--success);
        color: white;
      }
      .btn-success:hover {
        background: #3aafd6;
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }
      .btn-danger:hover {
        background: #d1146a;
      }

      .btn-warning {
        background: var(--warning);
        color: white;
      }
      .btn-warning:hover {
        background: #df8512;
      }

      .btn-info {
        background: var(--info);
        color: white;
      }
      .btn-info:hover {
        background: #3a7dc8;
      }

      .btn-alert {
        background: var(--danger);
        color: white;
        font-weight: bold;
      }
      .btn-alert:hover {
        background: #d1146a;
      }

      /* System Status */
      .system-status {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }

      .status-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }

      .status-item:last-child {
        border-bottom: none;
      }

      .status-label {
        font-weight: 500;
      }

      .status-value {
        font-weight: 600;
      }

      .online {
        color: #28a745;
      }
      .offline {
        color: #dc3545;
      }
      .warning {
        color: #ffc107;
      }

      /* File Upload */
      .upload-container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }

      .upload-area {
        border: 2px dashed #dee2e6;
        border-radius: var(--border-radius);
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 15px;
      }

      .upload-area:hover {
        border-color: var(--primary);
        background: rgba(67, 97, 238, 0.05);
      }

      .upload-area i {
        font-size: 3rem;
        color: #6c757d;
        margin-bottom: 15px;
      }

      .upload-text {
        color: #6c757d;
        margin-bottom: 10px;
      }

      /* Message Box */
      #messageBox {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: var(--border-radius);
        font-weight: 500;
        z-index: 2000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        display: none;
        max-width: 400px;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .success {
        background: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
      }

      /* Responsive */
      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
        }
        .sidebar.active {
          transform: translateX(0);
        }
        .main-content {
          margin-left: 0;
        }
        .menu-toggle {
          display: block;
        }
      }

      .menu-toggle {
        display: none;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 4px;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        align-items: center;
        justify-content: center;
      }

      /* Tabs */
      .tabs {
        display: flex;
        margin-bottom: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: var(--border-radius);
        overflow: hidden;
      }

      .tab-btn {
        flex: 1;
        padding: 15px;
        text-align: center;
        background: #f8f9fa;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
      }

      .tab-btn.active {
        background: var(--primary);
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 500px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: modalFadeIn 0.3s ease;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #dee2e6;
      }

      .modal-title {
        font-size: 1.5rem;
        color: var(--dark);
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6c757d;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2><i class="fas fa-cogs"></i> Admin Panel</h2>
      </div>
      <ul class="sidebar-menu">
        <li>
          <a href="#" class="active"
            ><i class="fas fa-tachometer-alt"></i> Dashboard</a
          >
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <div>
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <h1>Quản Trị Hệ Thống</h1>
        </div>
        <div class="user-info">
          <img
            src="https://ui-avatars.com/api/?name=Admin&background=random"
            alt="User"
          />
          <span>Administrator</span>
        </div>
      </div>

      <!-- Dashboard Cards -->
      <div class="dashboard-cards">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">LocalStorage</h3>
            <div class="card-icon bg-primary">
              <i class="fas fa-database"></i>
            </div>
          </div>
          <div class="card-value" id="localStorageCount">0</div>
          <p class="card-desc">Số lượng mục trong LocalStorage</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">SessionStorage</h3>
            <div class="card-icon bg-success">
              <i class="fas fa-server"></i>
            </div>
          </div>
          <div class="card-value" id="sessionStorageCount">0</div>
          <p class="card-desc">Số lượng mục trong SessionStorage</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Trạng thái hệ thống</h3>
            <div class="card-icon bg-danger">
              <i class="fas fa-lock"></i>
            </div>
          </div>
          <div class="card-value" id="systemStatusText">Hoạt động</div>
          <p class="card-desc">Trạng thái hiện tại của hệ thống</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Dung lượng</h3>
            <div class="card-icon bg-warning">
              <i class="fas fa-hdd"></i>
            </div>
          </div>
          <div class="card-value" id="storageUsage">0 KB</div>
          <p class="card-desc">Dung lượng sử dụng</p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="actions">Thao tác</button>
        <button class="tab-btn" data-tab="backup">Sao lưu & Khôi phục</button>
        <button class="tab-btn" data-tab="settings">Cài đặt</button>
      </div>

      <!-- Actions Tab -->
      <div class="tab-content active" id="actions-tab">
        <div class="action-buttons">
          <button
            class="btn btn-danger"
            onclick="showConfirmModal('deleteAllData')"
          >
            <i class="fas fa-trash"></i> Xóa toàn bộ dữ liệu
          </button>
          <button class="btn btn-info" onclick="downloadBackup()">
            <i class="fas fa-download"></i> Tải xuống dữ liệu sao lưu
          </button>
          <button
            class="btn btn-warning"
            onclick="showConfirmModal('resetSettings')"
          >
            <i class="fas fa-redo"></i> Đặt lại cấu hình
          </button>
          <button
            class="btn btn-danger"
            onclick="showConfirmModal('deleteLocalStorage')"
          >
            <i class="fas fa-eraser"></i> Xóa LocalStorage
          </button>
          <button
            class="btn btn-danger"
            onclick="showConfirmModal('deleteSessionStorage')"
          >
            <i class="fas fa-eraser"></i> Xóa SessionStorage
          </button>
          <button class="btn btn-success" onclick="restoreData()">
            <i class="fas fa-undo"></i> Khôi phục dữ liệu
          </button>
          <button
            class="btn btn-alert"
            onclick="showConfirmModal('lockEntireSystem')"
          >
            <i class="fas fa-lock"></i> Khóa Toàn Bộ Hệ Thống
          </button>
        </div>
      </div>

      <!-- Backup Tab -->
      <div class="tab-content" id="backup-tab">
        <div class="upload-container">
          <h3>Khôi phục dữ liệu từ file</h3>
          <div class="upload-area" id="dropZone">
            <i class="fas fa-cloud-upload-alt"></i>
            <p class="upload-text">
              Kéo thả file backup vào đây hoặc click để chọn file
            </p>
            <button class="btn btn-primary">
              <i class="fas fa-file-upload"></i> Chọn file
            </button>
            <input
              type="file"
              id="fileInput"
              accept=".json"
              style="display: none"
              onchange="importData(event)"
            />
          </div>
          <p class="card-desc">
            Chỉ chấp nhận file có định dạng JSON được xuất từ hệ thống
          </p>
        </div>

        <div class="system-status">
          <h3>Lịch sử sao lưu</h3>
          <div class="status-item">
            <span class="status-label">Sao lưu gần nhất</span>
            <span class="status-value" id="lastBackup">Chưa có</span>
          </div>
          <div class="status-item">
            <span class="status-label">Kích thước backup</span>
            <span class="status-value" id="backupSize">0 KB</span>
          </div>
          <div class="status-item">
            <span class="status-label">Tự động sao lưu</span>
            <span class="status-value online">Đang bật</span>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div class="tab-content" id="settings-tab">
        <div class="system-status">
          <h3>Cài đặt hệ thống</h3>
          <div class="status-item">
            <span class="status-label">Ngôn ngữ</span>
            <select class="status-value" id="languageSelect">
              <option value="vi">Tiếng Việt</option>
              <option value="en">English</option>
            </select>
          </div>
          <div class="status-item">
            <span class="status-label">Tự động sao lưu</span>
            <label class="switch">
              <input type="checkbox" id="autoBackup" checked />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="status-item">
            <span class="status-label">Thông báo</span>
            <label class="switch">
              <input type="checkbox" id="notifications" checked />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="status-item">
            <span class="status-label">Chế độ tối</span>
            <label class="switch">
              <input type="checkbox" id="darkMode" />
              <span class="slider round"></span>
            </label>
          </div>
        </div>

        <button
          class="btn btn-primary"
          style="margin-top: 20px"
          onclick="saveSettings()"
        >
          <i class="fas fa-save"></i> Lưu cài đặt
        </button>
      </div>

      <!-- System Status -->
      <div class="system-status">
        <h3>Thông tin hệ thống</h3>
        <div class="status-item">
          <span class="status-label">Trình duyệt</span>
          <span class="status-value" id="browserInfo"></span>
        </div>
        <div class="status-item">
          <span class="status-label">Phiên bản</span>
          <span class="status-value" id="versionInfo">1.2.0</span>
        </div>
        <div class="status-item">
          <span class="status-label">Trạng thái</span>
          <span class="status-value online" id="globalStatus">Hoạt động</span>
        </div>
        <div class="status-item">
          <span class="status-label">Bộ nhớ sử dụng</span>
          <span class="status-value" id="memoryUsage">Đang tính...</span>
        </div>
      </div>
    </div>

    <!-- Message Box -->
    <div id="messageBox"></div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">Xác nhận hành động</h3>
          <button class="close-modal" onclick="closeModal()">&times;</button>
        </div>
        <p id="modalMessage">Bạn có chắc chắn muốn thực hiện hành động này?</p>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeModal()">Hủy bỏ</button>
          <button class="btn btn-danger" id="confirmAction">Xác nhận</button>
        </div>
      </div>
    </div>

    <script>
      // Khởi tạo biến toàn cục
      let backupData = {
        localStorage: null,
        sessionStorage: null,
        settings: null,
      };
      let systemLocked = false;
      let entireSystemLocked = false;
      let currentAction = "";

      // Khởi tạo khi trang được tải
      document.addEventListener("DOMContentLoaded", function () {
        updateSystemStatus();
        updateDashboard();
        detectBrowser();
        setupEventListeners();
        loadSettings();
        calculateStorageUsage();
        setInterval(updateSystemStatus, 5000);
        setInterval(calculateStorageUsage, 10000);
      });

      // Thiết lập event listeners
      function setupEventListeners() {
        // Menu toggle
        document
          .getElementById("menuToggle")
          .addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("active");
          });

        // Tab switching
        document.querySelectorAll(".tab-btn").forEach((button) => {
          button.addEventListener("click", function () {
            // Remove active class from all buttons and content
            document
              .querySelectorAll(".tab-btn")
              .forEach((btn) => btn.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((content) => content.classList.remove("active"));

            // Add active class to clicked button and corresponding content
            this.classList.add("active");
            const tabId = this.getAttribute("data-tab");
            document.getElementById(`${tabId}-tab`).classList.add("active");
          });
        });

        // Drag and drop for file upload
        const dropZone = document.getElementById("dropZone");
        dropZone.addEventListener("click", () =>
          document.getElementById("fileInput").click()
        );

        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.style.borderColor = "var(--primary)";
          dropZone.style.backgroundColor = "rgba(67, 97, 238, 0.1)";
        });

        dropZone.addEventListener("dragleave", () => {
          dropZone.style.borderColor = "#dee2e6";
          dropZone.style.backgroundColor = "transparent";
        });

        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.style.borderColor = "#dee2e6";
          dropZone.style.backgroundColor = "transparent";

          if (e.dataTransfer.files.length) {
            document.getElementById("fileInput").files = e.dataTransfer.files;
            importData({ target: { files: e.dataTransfer.files } });
          }
        });
      }

      // Hiển thị thông báo
      function showMessage(message, type) {
        const messageBox = document.getElementById("messageBox");
        messageBox.textContent = message;
        messageBox.className = type ? "success" : "error";
        messageBox.style.display = "block";

        setTimeout(() => {
          messageBox.style.display = "none";
        }, 3000);
      }

      // Cập nhật trạng thái hệ thống
      function updateSystemStatus() {
        const localCount = Object.keys(localStorage).length;
        const sessionCount = Object.keys(sessionStorage).length;

        document.getElementById("localStorageCount").textContent = localCount;
        document.getElementById("sessionStorageCount").textContent =
          sessionCount;

        const statusText = entireSystemLocked
          ? "Đã khóa"
          : systemLocked
          ? "Hạn chế"
          : "Hoạt động";
        const statusClass = entireSystemLocked
          ? "offline"
          : systemLocked
          ? "warning"
          : "online";

        document.getElementById("systemStatusText").textContent = statusText;
        document.getElementById("systemStatusText").className = statusClass;
        document.getElementById("globalStatus").textContent = statusText;
        document.getElementById("globalStatus").className = statusClass;
      }

      // Cập nhật dashboard
      function updateDashboard() {
        const localCount = Object.keys(localStorage).length;
        const sessionCount = Object.keys(sessionStorage).length;

        document.getElementById("localStorageCount").textContent = localCount;
        document.getElementById("sessionStorageCount").textContent =
          sessionCount;

        // Cập nhật thời gian backup gần nhất
        const lastBackup = localStorage.getItem("lastBackup");
        if (lastBackup) {
          document.getElementById("lastBackup").textContent = new Date(
            parseInt(lastBackup)
          ).toLocaleString();
        }
      }

      // Tính toán dung lượng lưu trữ
      function calculateStorageUsage() {
        let totalBytes = 0;

        // Tính localStorage
        for (let key in localStorage) {
          if (localStorage.hasOwnProperty(key)) {
            totalBytes += localStorage[key].length * 2; // UTF-16 chiếm 2 byte mỗi ký tự
          }
        }

        // Tính sessionStorage
        for (let key in sessionStorage) {
          if (sessionStorage.hasOwnProperty(key)) {
            totalBytes += sessionStorage[key].length * 2;
          }
        }

        const totalKB = (totalBytes / 1024).toFixed(2);
        document.getElementById("storageUsage").textContent = `${totalKB} KB`;

        // Cập nhật kích thước backup
        document.getElementById("backupSize").textContent = `${totalKB} KB`;

        // Cập nhật sử dụng bộ nhớ
        if (performance.memory) {
          const usedMemory = (
            performance.memory.usedJSHeapSize / 1048576
          ).toFixed(2);
          const totalMemory = (
            performance.memory.totalJSHeapSize / 1048576
          ).toFixed(2);
          document.getElementById(
            "memoryUsage"
          ).textContent = `${usedMemory} MB / ${totalMemory} MB`;
        }
      }

      // Phát hiện trình duyệt
      function detectBrowser() {
        const userAgent = navigator.userAgent;
        let browserName;

        if (userAgent.includes("Chrome") && !userAgent.includes("Edg")) {
          browserName = "Google Chrome";
        } else if (userAgent.includes("Firefox")) {
          browserName = "Mozilla Firefox";
        } else if (
          userAgent.includes("Safari") &&
          !userAgent.includes("Chrome")
        ) {
          browserName = "Apple Safari";
        } else if (userAgent.includes("Edg")) {
          browserName = "Microsoft Edge";
        } else {
          browserName = "Trình duyệt không xác định";
        }

        document.getElementById("browserInfo").textContent = browserName;
      }

      // Sao lưu dữ liệu
      function backupAllData() {
        backupData.localStorage = { ...localStorage };
        backupData.sessionStorage = { ...sessionStorage };
        backupData.settings = JSON.parse(
          localStorage.getItem("systemSettings") || "{}"
        );

        // Lưu thời gian backup
        localStorage.setItem("lastBackup", Date.now().toString());
        updateDashboard();

        showMessage("Dữ liệu đã được sao lưu!", true);
      }

      // Xóa toàn bộ dữ liệu
      function deleteAllData() {
        if (entireSystemLocked) {
          showMessage(
            "Hệ thống đã bị khóa toàn bộ. Không thể thực hiện thao tác này.",
            false
          );
          return;
        }

        backupAllData();
        localStorage.clear();
        sessionStorage.clear();
        showMessage("Dữ liệu đã bị xóa!", true);
        updateSystemStatus();
        updateDashboard();
      }

      // Xóa selective
      function deleteSelective(type) {
        if (entireSystemLocked) {
          showMessage(
            "Hệ thống đã bị khóa toàn bộ. Không thể thực hiện thao tác này.",
            false
          );
          return;
        }

        backupAllData();
        if (type === "local") {
          localStorage.clear();
        } else if (type === "session") {
          sessionStorage.clear();
        }
        showMessage(`Dữ liệu ${type} đã bị xóa!`, true);
        updateSystemStatus();
        updateDashboard();
      }

      // Khóa toàn bộ hệ thống
      function lockEntireSystem() {
        entireSystemLocked = true;
        localStorage.clear();
        sessionStorage.clear();
        showMessage("Toàn bộ hệ thống đã bị khóa và dữ liệu đã bị xóa!", false);
        updateSystemStatus();
        updateDashboard();
      }

      // Khôi phục dữ liệu
      function restoreData() {
        if (!backupData.localStorage && !backupData.sessionStorage) {
          showMessage("Không có dữ liệu nào để khôi phục!", false);
          return;
        }

        if (backupData.localStorage) {
          for (const key in backupData.localStorage) {
            localStorage.setItem(key, backupData.localStorage[key]);
          }
        }

        if (backupData.sessionStorage) {
          for (const key in backupData.sessionStorage) {
            sessionStorage.setItem(key, backupData.sessionStorage[key]);
          }
        }

        if (backupData.settings) {
          localStorage.setItem(
            "systemSettings",
            JSON.stringify(backupData.settings)
          );
          loadSettings();
        }

        showMessage("Dữ liệu đã được khôi phục!", true);
        updateSystemStatus();
        updateDashboard();
      }

      // Tải về backup
      function downloadBackup() {
        const groupedData = {
          localStorage: {},
          sessionStorage: {},
          cookies: document.cookie,
          timestamp: new Date().toISOString(),
          system: {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
          },
        };

        // Lấy dữ liệu từ localStorage
        for (const key in localStorage) {
          if (localStorage.hasOwnProperty(key)) {
            groupedData.localStorage[key] = localStorage[key];
          }
        }

        // Lấy dữ liệu từ sessionStorage
        for (const key in sessionStorage) {
          if (sessionStorage.hasOwnProperty(key)) {
            groupedData.sessionStorage[key] = sessionStorage[key];
          }
        }

        // Tạo dữ liệu dạng chuỗi JSON
        const dataStr = JSON.stringify(groupedData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const link = document.createElement("a");

        link.href = URL.createObjectURL(blob);
        link.download = `backup-${new Date().toISOString().slice(0, 10)}.json`;
        link.click();

        showMessage("Dữ liệu sao lưu đã được tải xuống!", true);

        // Lưu thời gian backup
        localStorage.setItem("lastBackup", Date.now().toString());
        updateDashboard();
      }

      // Nhập dữ liệu
      function importData(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);

            // Lưu dữ liệu vào localStorage và sessionStorage
            if (importedData.localStorage) {
              for (const key in importedData.localStorage) {
                localStorage.setItem(key, importedData.localStorage[key]);
              }
            }

            if (importedData.sessionStorage) {
              for (const key in importedData.sessionStorage) {
                sessionStorage.setItem(key, importedData.sessionStorage[key]);
              }
            }

            showMessage("Dữ liệu đã được nhập và lưu thành công!", true);
            updateSystemStatus();
            updateDashboard();
          } catch (error) {
            showMessage("Lỗi khi đọc file: " + error.message, false);
          }
        };
        reader.readAsText(file);
      }

      // Đặt lại cấu hình
      function resetSettings() {
        if (entireSystemLocked) {
          showMessage(
            "Hệ thống đã bị khóa toàn bộ. Không thể thực hiện thao tác này.",
            false
          );
          return;
        }

        const defaultConfig = {
          theme: "light",
          notifications: true,
          language: "vi",
          autoBackup: true,
        };

        localStorage.setItem("systemSettings", JSON.stringify(defaultConfig));
        loadSettings();

        showMessage("Cấu hình đã được đặt lại về mặc định!", true);
      }

      // Hiển thị modal xác nhận
      function showConfirmModal(action) {
        currentAction = action;
        const modal = document.getElementById("confirmModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalMessage = document.getElementById("modalMessage");
        const confirmButton = document.getElementById("confirmAction");

        let title, message, buttonText;

        switch (action) {
          case "deleteAllData":
            title = "Xóa toàn bộ dữ liệu";
            message =
              "Bạn có chắc chắn muốn xóa toàn bộ dữ liệu? Hành động này không thể hoàn tác.";
            buttonText = "Xóa toàn bộ";
            break;
          case "resetSettings":
            title = "Đặt lại cấu hình";
            message =
              "Bạn có chắc chắn muốn đặt lại toàn bộ cấu hình về mặc định?";
            buttonText = "Đặt lại";
            break;
          case "deleteLocalStorage":
            title = "Xóa LocalStorage";
            message = "Bạn có chắc chắn muốn xóa toàn bộ dữ liệu LocalStorage?";
            buttonText = "Xóa LocalStorage";
            break;
          case "deleteSessionStorage":
            title = "Xóa SessionStorage";
            message =
              "Bạn có chắc chắn muốn xóa toàn bộ dữ liệu SessionStorage?";
            buttonText = "Xóa SessionStorage";
            break;
          case "lockEntireSystem":
            title = "Khóa toàn bộ hệ thống";
            message =
              "Bạn có chắc chắn muốn khóa toàn bộ hệ thống? Hành động này sẽ xóa toàn bộ dữ liệu và không thể hoàn tác.";
            buttonText = "Khóa hệ thống";
            break;
        }

        modalTitle.textContent = title;
        modalMessage.textContent = message;
        confirmButton.textContent = buttonText;

        modal.style.display = "flex";
      }

      // Đóng modal
      function closeModal() {
        document.getElementById("confirmModal").style.display = "none";
      }

      // Xác nhận hành động từ modal
      document
        .getElementById("confirmAction")
        .addEventListener("click", function () {
          closeModal();

          switch (currentAction) {
            case "deleteAllData":
              deleteAllData();
              break;
            case "resetSettings":
              resetSettings();
              break;
            case "deleteLocalStorage":
              deleteSelective("local");
              break;
            case "deleteSessionStorage":
              deleteSelective("session");
              break;
            case "lockEntireSystem":
              lockEntireSystem();
              break;
          }
        });

      // Tải cài đặt
      function loadSettings() {
        const settings = JSON.parse(
          localStorage.getItem("systemSettings") || "{}"
        );

        if (settings.language) {
          document.getElementById("languageSelect").value = settings.language;
        }

        if (settings.autoBackup !== undefined) {
          document.getElementById("autoBackup").checked = settings.autoBackup;
        }

        if (settings.notifications !== undefined) {
          document.getElementById("notifications").checked =
            settings.notifications;
        }

        if (settings.darkMode !== undefined) {
          document.getElementById("darkMode").checked = settings.darkMode;
          if (settings.darkMode) {
            document.documentElement.style.setProperty("--light", "#212529");
            document.documentElement.style.setProperty("--dark", "#f8f9fa");
          }
        }
      }

      // Lưu cài đặt
      function saveSettings() {
        const settings = {
          language: document.getElementById("languageSelect").value,
          autoBackup: document.getElementById("autoBackup").checked,
          notifications: document.getElementById("notifications").checked,
          darkMode: document.getElementById("darkMode").checked,
        };

        localStorage.setItem("systemSettings", JSON.stringify(settings));
        showMessage("Cài đặt đã được lưu thành công!", true);

        // Áp dụng chế độ tối ngay lập tức
        if (settings.darkMode) {
          document.documentElement.style.setProperty("--light", "#212529");
          document.documentElement.style.setProperty("--dark", "#f8f9fa");
        } else {
          document.documentElement.style.setProperty("--light", "#f8f9fa");
          document.documentElement.style.setProperty("--dark", "#212529");
        }
      }
    </script>
  </body>
</html>
