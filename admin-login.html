<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Đăng nhập Admin</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --bg1: #071029;
        --bg2: #0f2040;
        --card: #0f1724;
        --accent: #8a7bff;
        --accent2: #4fe0b2;
        --accent3: #ff7eb3;
        --muted: #9fb1c8;
        --success: #4fe0b2;
        --error: #ff6b6b;
        --warning: #ffd166;
        --transition: all 0.3s ease;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(
            600px 400px at 20% 20%,
            rgba(138, 123, 255, 0.12),
            transparent
          ),
          radial-gradient(
            600px 400px at 90% 80%,
            rgba(79, 224, 178, 0.08),
            transparent
          ),
          linear-gradient(180deg, var(--bg1), var(--bg2));
        color: #eaf4fb;
        padding: 20px;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
      }

      body.light-theme {
        --bg1: #f0f2f5;
        --bg2: #ffffff;
        --card: #ffffff;
        --muted: #6c757d;
        background: radial-gradient(
            600px 400px at 20% 20%,
            rgba(138, 123, 255, 0.08),
            transparent
          ),
          radial-gradient(
            600px 400px at 90% 80%,
            rgba(79, 224, 178, 0.05),
            transparent
          ),
          linear-gradient(180deg, var(--bg1), var(--bg2));
      }

      /* Particles background */
      .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }

      .particle {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
        animation: float 15s infinite ease-in-out;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) translateX(0);
        }
        25% {
          transform: translateY(-20px) translateX(10px);
        }
        50% {
          transform: translateY(-35px) translateX(-15px);
        }
        75% {
          transform: translateY(-15px) translateX(15px);
        }
      }

      .wrap {
        width: 100%;
        max-width: 440px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.02)
        );
        border-radius: 14px;
        padding: 24px;
        box-shadow: 0 12px 40px rgba(3, 8, 23, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(6px) saturate(120%);
        animation: rise 0.45s cubic-bezier(0.2, 0.9, 0.3, 1);
        position: relative;
        overflow: hidden;
        z-index: 1;
        transition: var(--transition);
      }

      .light-theme .wrap {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.8),
          rgba(255, 255, 255, 0.9)
        );
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.6);
        color: #333;
      }

      .wrap::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(138, 123, 255, 0.05) 0%,
          transparent 70%
        );
        transform: rotate(30deg);
        z-index: -1;
      }

      .light-theme .wrap::before {
        background: radial-gradient(
          circle,
          rgba(138, 123, 255, 0.08) 0%,
          transparent 70%
        );
      }

      @keyframes rise {
        from {
          opacity: 0;
          transform: translateY(18px) scale(0.995);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      .brand {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 18px;
        position: relative;
      }

      .logo-container {
        width: 52px;
        height: 52px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent), #5f8bff);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 22px rgba(90, 70, 255, 0.12);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        overflow: hidden;
      }

      .logo-container:hover {
        transform: translateY(-3px) rotate(5deg);
        box-shadow: 0 12px 30px rgba(90, 70, 255, 0.2);
      }

      .logo-container img {
        width: 30px;
        height: 30px;
        object-fit: contain;
      }

      h2 {
        margin: 0;
        font-size: 1.2rem;
        color: #fff;
        font-weight: 700;
        transition: var(--transition);
      }

      .light-theme h2 {
        color: #333;
      }

      p.desc {
        margin: 4px 0 0;
        color: var(--muted);
        font-size: 0.9rem;
        transition: var(--transition);
      }

      form {
        margin-top: 16px;
      }

      .input-group {
        position: relative;
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-size: 0.85rem;
        color: var(--muted);
        margin-bottom: 6px;
        font-weight: 600;
        transition: var(--transition);
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 12px 14px 12px 40px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.04);
        color: #eaf4fb;
        outline: none;
        transition: box-shadow 0.14s, transform 0.12s, border-color 0.12s;
        font-size: 1rem;
        transition: var(--transition);
      }

      .light-theme input[type="text"],
      .light-theme input[type="password"] {
        background: rgba(0, 0, 0, 0.03);
        border: 1px solid rgba(0, 0, 0, 0.08);
        color: #333;
      }

      .input-icon {
        position: absolute;
        left: 14px;
        top: 38px;
        color: var(--muted);
        font-size: 16px;
        transition: var(--transition);
      }

      input::placeholder {
        color: rgba(234, 244, 251, 0.4);
        transition: var(--transition);
      }

      .light-theme input::placeholder {
        color: rgba(51, 51, 51, 0.5);
      }

      input:focus {
        box-shadow: 0 8px 26px rgba(74, 66, 190, 0.16);
        border-color: rgba(138, 123, 255, 0.38);
        transform: translateY(-1px);
      }

      .light-theme input:focus {
        box-shadow: 0 8px 26px rgba(138, 123, 255, 0.2);
      }

      .password-toggle {
        position: absolute;
        right: 14px;
        top: 38px;
        color: var(--muted);
        cursor: pointer;
        font-size: 16px;
        transition: var(--transition);
      }

      .btn {
        width: 100%;
        padding: 12px;
        margin-top: 12px;
        background: linear-gradient(90deg, var(--accent), #5f8bff);
        border: none;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 700;
        box-shadow: 0 10px 28px rgba(79, 67, 255, 0.12);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .btn::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transform: translateX(-100%);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(79, 67, 255, 0.2);
      }

      .btn:hover::after {
        animation: shimmer 1.5s infinite;
      }

      @keyframes shimmer {
        100% {
          transform: translateX(100%);
        }
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn.loading {
        pointer-events: none;
        opacity: 0.8;
      }

      .btn.loading i {
        margin-right: 8px;
        animation: spin 1s infinite linear;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .msg {
        margin-top: 12px;
        font-size: 0.95rem;
        min-height: 26px;
        transition: opacity 0.15s;
        display: flex;
        align-items: center;
        padding: 10px 12px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        transition: var(--transition);
      }

      .light-theme .msg {
        background: rgba(0, 0, 0, 0.03);
      }

      .msg i {
        margin-right: 8px;
      }

      .msg.ok {
        color: var(--success);
        background: rgba(79, 224, 178, 0.08);
        border-left: 3px solid var(--success);
      }

      .light-theme .msg.ok {
        background: rgba(79, 224, 178, 0.15);
      }

      .msg.err {
        color: var(--error);
        background: rgba(255, 107, 107, 0.08);
        border-left: 3px solid var(--error);
      }

      .light-theme .msg.err {
        background: rgba(255, 107, 107, 0.15);
      }

      .msg.info {
        color: var(--accent);
        background: rgba(138, 123, 255, 0.08);
        border-left: 3px solid var(--accent);
      }

      .light-theme .msg.info {
        background: rgba(138, 123, 255, 0.15);
      }

      .additional-options {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        font-size: 0.85rem;
      }

      .remember-me {
        display: flex;
        align-items: center;
      }

      .remember-me input {
        margin-right: 6px;
      }

      .forgot-password {
        color: var(--accent);
        text-decoration: none;
        transition: var(--transition);
      }

      .forgot-password:hover {
        color: var(--accent2);
        text-decoration: underline;
      }

      .language-selector {
        position: absolute;
        top: 10px;
        right: 10px;
      }

      .language-selector select {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 6px;
        color: var(--muted);
        padding: 5px 8px;
        font-size: 0.8rem;
        outline: none;
        cursor: pointer;
        transition: var(--transition);
      }

      .light-theme .language-selector select {
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.08);
      }

      .theme-toggle {
        position: absolute;
        top: 10px;
        right: 100px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 6px;
        color: var(--muted);
        padding: 5px 8px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .light-theme .theme-toggle {
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.08);
      }

      .footer {
        margin-top: 20px;
        text-align: center;
        font-size: 0.8rem;
        color: var(--muted);
        transition: var(--transition);
      }

      /* Responsive adjustments */
      @media (max-width: 480px) {
        .wrap {
          padding: 20px;
        }

        .brand {
          flex-direction: column;
          text-align: center;
          gap: 15px;
        }

        .additional-options {
          flex-direction: column;
          gap: 10px;
        }

        .language-selector,
        .theme-toggle {
          position: relative;
          top: 0;
          right: 0;
          margin-bottom: 10px;
          text-align: center;
          width: 100%;
        }
      }

      /* Animation for success login */
      @keyframes successPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }

      .success-animation {
        animation: successPulse 0.5s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div class="particles" id="particles"></div>

    <div class="wrap" role="main">
      <div class="language-selector">
        <select id="languageSelect">
          <option value="vi" selected>Tiếng Việt</option>
          <option value="en">English</option>
        </select>
      </div>

      <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
      </button>

      <div class="brand">
        <button class="logo-container" onclick="window.location.href='/'">
          <img
            src="assets/logo.svg"
            alt="KNY Logo"
            onerror="this.style.display='none'; this.parentNode.innerHTML='KNY';"
          />
        </button>
        <div>
          <h2 id="loginTitle">Đăng nhập Admin</h2>
          <p class="desc" id="loginDesc">
            Đăng nhập bằng tài khoản admin đã tạo trước đó.
          </p>
        </div>
      </div>

      <form id="loginForm" autocomplete="off">
        <div class="input-group">
          <label for="user" id="usernameLabel">Tên đăng nhập</label>
          <i class="fas fa-user input-icon"></i>
          <input id="user" name="user" type="text" placeholder="admin" />
        </div>

        <div class="input-group">
          <label for="pass" id="passwordLabel">Mật khẩu</label>
          <i class="fas fa-lock input-icon"></i>
          <input id="pass" name="pass" type="password" placeholder="mật khẩu" />
          <i class="fas fa-eye password-toggle" id="passwordToggle"></i>
        </div>

        <div class="additional-options">
          <div class="remember-me">
            <input type="checkbox" id="rememberMe" />
            <label for="rememberMe" id="rememberLabel">Ghi nhớ đăng nhập</label>
          </div>

          <a
            href="/forgot-password.html"
            class="forgot-password"
            id="forgotPassword"
            >Quên mật khẩu?</a
          >
        </div>

        <button class="btn" type="submit" id="loginButton">
          <i class="fas fa-sign-in-alt"></i> Đăng nhập
        </button>

        <div class="msg" id="message" aria-live="polite"></div>
      </form>

      <div class="footer">
        <p id="footerText">© 2025 KNY Admin Panel. Phiên bản 1.3.0</p>
      </div>
    </div>

    <script>
      // Tạo particles background
      function createParticles() {
        const container = document.getElementById("particles");
        const particleCount = 20;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement("div");
          particle.classList.add("particle");

          // Random kích thước và vị trí
          const size = Math.random() * 10 + 5;
          const posX = Math.random() * 100;
          const posY = Math.random() * 100;
          const delay = Math.random() * 15;

          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.left = `${posX}%`;
          particle.style.top = `${posY}%`;
          particle.style.animationDelay = `${delay}s`;

          container.appendChild(particle);
        }
      }

      // Khởi tạo ứng dụng
      document.addEventListener("DOMContentLoaded", function () {
        createParticles();

        const STORAGE_KEY = "kny_admin_account";
        const msgEl = document.getElementById("message");
        const form = document.getElementById("loginForm");
        const userEl = document.getElementById("user");
        const passEl = document.getElementById("pass");
        const passwordToggle = document.getElementById("passwordToggle");
        const loginButton = document.getElementById("loginButton");
        const rememberMe = document.getElementById("rememberMe");
        const themeToggle = document.getElementById("themeToggle");
        const languageSelect = document.getElementById("languageSelect");

        // Kiểm tra xem có thông tin đăng nhập đã lưu không
        const savedUsername = localStorage.getItem("kny_remembered_username");
        if (savedUsername) {
          userEl.value = savedUsername;
          rememberMe.checked = true;
        }

        // Chuyển đổi hiển thị mật khẩu
        passwordToggle.addEventListener("click", function () {
          if (passEl.type === "password") {
            passEl.type = "text";
            passwordToggle.classList.remove("fa-eye");
            passwordToggle.classList.add("fa-eye-slash");
          } else {
            passEl.type = "password";
            passwordToggle.classList.remove("fa-eye-slash");
            passwordToggle.classList.add("fa-eye");
          }
        });

        // Chuyển đổi chế độ sáng/tối
        themeToggle.addEventListener("click", function () {
          document.body.classList.toggle("light-theme");
          const icon = themeToggle.querySelector("i");

          if (document.body.classList.contains("light-theme")) {
            icon.classList.remove("fa-moon");
            icon.classList.add("fa-sun");
          } else {
            icon.classList.remove("fa-sun");
            icon.classList.add("fa-moon");
          }
        });

        // Xử lý thay đổi ngôn ngữ
        languageSelect.addEventListener("change", function () {
          // Đây là nơi bạn sẽ thêm logic đa ngôn ngữ
          // Hiện tại chỉ để minh họa
          if (this.value === "en") {
            document.getElementById("loginTitle").textContent = "Admin Login";
            document.getElementById("loginDesc").textContent =
              "Login with your previously created admin account.";
            document.getElementById("usernameLabel").textContent = "Username";
            document.getElementById("passwordLabel").textContent = "Password";
            userEl.placeholder = "admin";
            passEl.placeholder = "password";
            document.getElementById("rememberLabel").textContent =
              "Remember me";
            document.getElementById("forgotPassword").textContent =
              "Forgot password?";
            loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
            document.getElementById("footerText").textContent =
              "© 2025 KNY Admin Panel. Version 1.3.0";
          } else {
            document.getElementById("loginTitle").textContent =
              "Đăng nhập Admin";
            document.getElementById("loginDesc").textContent =
              "Đăng nhập bằng tài khoản admin đã tạo trước đó.";
            document.getElementById("usernameLabel").textContent =
              "Tên đăng nhập";
            document.getElementById("passwordLabel").textContent = "Mật khẩu";
            userEl.placeholder = "admin";
            passEl.placeholder = "mật khẩu";
            document.getElementById("rememberLabel").textContent =
              "Ghi nhớ đăng nhập";
            document.getElementById("forgotPassword").textContent =
              "Quên mật khẩu?";
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
            document.getElementById("footerText").textContent =
              "© 2025 KNY Admin Panel. Phiên bản 1.3.0";
          }
        });

        async function sha256Hex(message) {
          const enc = new TextEncoder();
          const data = enc.encode(message);
          const hashBuffer = await crypto.subtle.digest("SHA-256", data);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
        }

        function showMsg(text, type = "") {
          msgEl.innerHTML =
            type === ""
              ? text
              : `<i class="fas fa-${
                  type === "ok"
                    ? "check-circle"
                    : type === "err"
                    ? "exclamation-circle"
                    : "info-circle"
                }"></i> ${text}`;
          msgEl.className = "msg" + (type ? " " + type : "");
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          showMsg("", "");

          const username = userEl.value.trim();
          const password = passEl.value;

          if (!username || !password) {
            showMsg("Vui lòng nhập tên đăng nhập và mật khẩu.", "err");
            return;
          }

          // Lưu thông tin đăng nhập nếu người dùng chọn
          if (rememberMe.checked) {
            localStorage.setItem("kny_remembered_username", username);
          } else {
            localStorage.removeItem("kny_remembered_username");
          }

          // Hiển thị trạng thái loading
          loginButton.classList.add("loading");
          loginButton.innerHTML =
            '<i class="fas fa-spinner"></i> Đang xử lý...';

          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) {
            showMsg(
              "Chưa có tài khoản admin. Vui lòng tạo tài khoản trước.",
              "err"
            );
            loginButton.classList.remove("loading");
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
            return;
          }

          let stored;
          try {
            stored = JSON.parse(raw);
          } catch (err) {
            showMsg("Dữ liệu tài khoản bị lỗi.", "err");
            loginButton.classList.remove("loading");
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
            return;
          }

          if (stored.username !== username) {
            showMsg("Sai tên đăng nhập hoặc mật khẩu.", "err");
            loginButton.classList.remove("loading");
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
            return;
          }

          showMsg("Đang xác thực...", "info");

          try {
            const hashed = await sha256Hex(password);
            if (hashed === stored.passwordHash) {
              // Lưu trạng thái đã login
              localStorage.setItem("isAdminLoggedIn", "true");

              // Thêm class animation cho success
              document
                .querySelector(".wrap")
                .classList.add("success-animation");

              showMsg("Đăng nhập thành công! Đang chuyển hướng...", "ok");

              setTimeout(() => {
                window.location.href = "kny-admin-web.html";
              }, 900);
            } else {
              showMsg("Sai tên đăng nhập hoặc mật khẩu.", "err");
              loginButton.classList.remove("loading");
              loginButton.innerHTML =
                '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
            }
          } catch (err) {
            console.error(err);
            showMsg("Có lỗi khi xác thực.", "err");
            loginButton.classList.remove("loading");
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
          }
        });
      });
    </script>
  </body>
</html>
